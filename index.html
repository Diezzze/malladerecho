<script>
  const correlatividades = {
    Lógica: ["Contenidos_transversales", "Historia_del_pensamiento", "Teoría_del_derecho_y_la_justicia"],
    Civil_I: ["Contenidos_transversales", "Nociones_de_economía", "Destrezas_I"],
    Derecho_constitucional: ["Contenidos_transversales", "Historia_del_pensamiento", "Teoría_del_derecho_y_la_justicia", "Teoría_del_estado"],
    Derecho_penal_I: ["Derecho_constitucional"],
    Obligaciones: ["Civil_I"],
    Nociones_de_Sociología: ["Contenidos_transversales", "Historia_del_pensamiento", "Teoría_del_estado"],
    Derecho_penal_II: ["Derecho_penal_I"],
    Contratos: ["Obligaciones"],
    Derecho_de_las_empresas: ["Contratos"],
    Derecho_procesal_I: ["Derecho_constitucional", "Civil_I", "Derecho_penal_II"],
    Derechos_humanos: ["Derecho_constitucional"],
    Destrezas_II: ["Destrezas_I", "Lógica", "Nociones_de_Sociología"]
  };

  let estados = {};

  function guardarEstado() {
    localStorage.setItem("estadoMaterias", JSON.stringify(estados));
  }

  function cargarEstado() {
    const guardado = localStorage.getItem("estadoMaterias");
    return guardado ? JSON.parse(guardado) : {};
  }

  function toggleAprobada(nombre) {
    const materia = document.getElementById(nombre);
    if (!materia.classList.contains("desbloqueada")) return;

    const yaAprobada = materia.classList.toggle("aprobada");
    estados[nombre] = yaAprobada;
    guardarEstado();
    actualizarDesbloqueos();
  }

  function actualizarDesbloqueos() {
    for (let mat in correlatividades) {
      const elem = document.getElementById(mat);
      const correlativas = correlatividades[mat];
      const todasOk = correlativas.every(c => estados[c]);
      if (!estados[mat]) {
        if (todasOk) {
          elem.classList.add("desbloqueada");
        } else {
          elem.classList.remove("desbloqueada");
        }
      }
    }
  }

  function reiniciarEstado() {
    // Borrar del almacenamiento local
    localStorage.removeItem("estadoMaterias");
    estados = {};

    // Quitar clases 'aprobada' y 'desbloqueada' de todas las materias
    document.querySelectorAll(".materia").forEach(elem => {
      elem.classList.remove("aprobada");
      const id = elem.id;
      if (correlatividades[id]) {
        elem.classList.remove("desbloqueada");
      } else {
        elem.classList.add("desbloqueada");
      }
    });
  }

  window.addEventListener("DOMContentLoaded", () => {
    estados = cargarEstado();
    for (let mat in estados) {
      if (estados[mat]) {
        const elem = document.getElementById(mat);
        if (elem) elem.classList.add("aprobada");
      }
    }
    actualizarDesbloqueos();
  });
</script>
